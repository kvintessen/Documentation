**Twig** — это мощный шаблонизатор, используемый в Symfony для рендеринга HTML-страниц. Он позволяет отделить логику отображения от бизнес-логики, улучшая читаемость и поддерживаемость кода. Twig предоставляет простой и выразительный синтаксис, который делает работу с шаблонами удобной и гибкой.

### Основные возможности Twig

1. **Вывод переменных**: Twig позволяет выводить данные в шаблонах через простую конструкцию `{{ переменная }}`.
2. **Фильтры**: Используются для изменения формата данных перед их выводом (например, преобразование строки в верхний регистр).
3. **Теги**: Используются для создания циклов, условий, блоков и наследования шаблонов.
4. **Макросы**: Позволяют создавать многоразовые блоки кода.
5. **Наследование шаблонов**: Twig поддерживает наследование, что позволяет переопределять только нужные части шаблонов.

### Пример простого Twig-шаблона

```Twig
{# templates/base.html.twig #}
<!DOCTYPE html>
<html>
	<head>
	    <title>{% block title %}Default title{% endblock %}</title>
	</head>
	<body>
	    <header>
	        {% block header %}
	            <h1>Welcome to my site</h1>
	        {% endblock %}
	    </header>
	
	    <main>
	        {% block body %}{% endblock %}
	    </main>
	
	    <footer>
	        {% block footer %}
	            <p>&copy; 2024 My Website</p>
	        {% endblock %}
	    </footer>
	</body>
</html>
```

Этот шаблон определяет базовую структуру HTML-документа с разделами для заголовка, тела и подвала. Благодаря использованию тегов `{% block %}`, этот шаблон может быть расширен дочерними шаблонами.

### Наследование шаблонов

Twig позволяет дочерним шаблонам расширять базовые шаблоны, наследуя их структуру и изменяя только нужные части.

Пример дочернего шаблона:

```Twig
{# templates/home.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Homepage{% endblock %}

{% block body %}
    <h2>This is the homepage</h2>
    <p>Welcome to my website!</p>
{% endblock %}
```

- **{% extends 'base.html.twig' %}** — Указывает, что этот шаблон наследуется от `base.html.twig`.
- Переопределяются блоки `title` и `body`.

### Вывод переменных

Для вывода данных в шаблоне Twig используется синтаксис с двойными фигурными скобками `{{ ... }}`. Например:

```Twig
<p>Hello, {{ name }}!</p>
```

Если переменная `name` содержит значение "John", то результатом будет:

```html
<p>Hello, John!</p>
```

### Фильтры

Фильтры в Twig используются для форматирования данных. Они применяются через символ `|`.

Примеры фильтров:

- **upper** — преобразует строку в верхний регистр:

```twig
{{ name|upper }}
```

- **date** — форматирует дату:

```twig
{{ date|date('Y-m-d') }}
```

- **length** — возвращает длину массива или строки:

```Twig
{{ items|length }}
```

- **default** — возвращает значение по умолчанию, если переменная не установлена:

```twig
{{ name|default('Anonymous') }}
```

### Циклы

Twig поддерживает циклы для итерации по массивам или коллекциям данных с помощью тега `{% for %}`.

Пример цикла:

```Twig
<ul>
    {% for item in items %}
        <li>{{ item }}</li>
    {% endfor %}
</ul>
```

Этот код выведет каждый элемент массива `items` в виде элемента списка.

Также можно использовать индексы в циклах:

```twig
{% for item in items %}
    <p>{{ loop.index }}: {{ item }}</p>
{% endfor %}
```

Здесь `loop.index` — это переменная, которая содержит текущий индекс итерации (начинается с 1).

### Условия

Условия в Twig работают через теги `{% if %}` и позволяют выполнять логику на основе переданных данных.

Пример использования условий:

```twig
{% if user.isLoggedIn %}
    <p>Welcome back, {{ user.name }}!</p>
{% else %}
    <p>Hello, Guest! Please <a href="/login">log in</a>.</p>
{% endif %}
```

Twig также поддерживает операторы `else` и `elseif`:

```Twig
{% if age >= 18 %}
    <p>You are an adult.</p>
{% elseif age >= 13 %}
    <p>You are a teenager.</p>
{% else %}
    <p>You are a child.</p>
{% endif %}
```

### Макросы

Макросы позволяют создавать многократно используемые шаблонные функции. Это особенно полезно, если нужно многократно выводить однотипные элементы, например, формы.

Пример макроса:

```Twig
{# templates/macros/form_macros.html.twig #}
{% macro input(name, label, value) %}
    <label for="{{ name }}">{{ label }}</label>
    <input type="text" name="{{ name }}" value="{{ value }}">
{% endmacro %}
```

Использование макроса:

```Twig
{% from 'macros/form_macros.html.twig' import input %}

{{ input('username', 'Username', '') }}
```

Макросы помогают избежать дублирования кода и делают шаблоны более компактными и читабельными.

### Включение шаблонов

Twig поддерживает включение других шаблонов в текущий шаблон через тег `{% include %}`.

Пример:

```Twig
{# templates/base.html.twig #}
<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}My Website{% endblock %}</title>
</head>
<body>
    {% include 'partials/header.html.twig' %}
    {% block body %}{% endblock %}
    {% include 'partials/footer.html.twig' %}
</body>
</html>
```

Шаблоны `header.html.twig` и `footer.html.twig` будут включены в основной шаблон.

### Рендеринг Twig-шаблонов в контроллере

В Symfony контроллеры используют метод `render()` для рендеринга Twig-шаблонов.

Пример контроллера:

```PHP
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;

class DefaultController extends AbstractController
{
    #[Route('/greet/{name}', name: 'greet')]
    public function greet(string $name): Response
    {
        return $this->render('greet.html.twig', [
            'name' => $name,
        ]);
    }
}
```

Этот код рендерит шаблон `greet.html.twig` и передает в него переменную `name`.

### Операции с массивами и объектами

Twig позволяет работать с массивами и объектами в шаблонах.

Пример работы с объектом:

```Twig
<p>User: {{ user.name }}</p>
<p>Email: {{ user.email }}</p>
```

Если у объекта `user` есть свойства `name` и `email`, они будут выведены в шаблоне.

Пример работы с массивом:

```Twig
<ul>
    {% for post in posts %}
        <li>{{ post.title }}</li>
    {% endfor %}
</ul>
```

### Функции Twig

Twig предоставляет ряд встроенных функций для выполнения различных задач.

Примеры функций:

- **`path()`** — возвращает URL для маршрута:

```Twig
<a href="{{ path('homepage') }}">Home</a>
```

- **`asset()`** — возвращает путь к статическому ресурсу (например, CSS-файлу):

```Twig
<link rel="stylesheet" href="{{ asset('css/styles.css') }}">
```

- **`dump()`** — выводит отладочную информацию о переменной:

```Twig
{{ dump(user) }}
```

- **`include()`** — включает другой шаблон:

```Twig
{{ include('header.html.twig') }}
```

### Расширение Twig

Twig можно расширять, добавляя свои функции, фильтры и глобальные переменные.

Пример добавления глобальной переменной:

1. В `services.yaml` можно задать глобальные переменные для использования в каждом шаблоне:

```YML
twig:
    globals:
        app_name: 'My Awesome App'
```

2. Теперь переменная `app_name` доступна в любом шаблоне:

### Безопасность и защита от XSS

Twig автоматически экранирует переменные для защиты от атак, таких как XSS (Cross-Site Scripting). Все переменные, выводимые через `{{ }}`, автоматически экранируются, чтобы предотвратить выполнение вредоносного кода.

Пример:

```Twig
<p>{{ user.name }}</p>
```

Если `user.name` содержит вредоносный код (например, `<script>alert('XSS');</script>`), Twig экранирует его и выведет безопасный текст.

### Заключение

Twig — это мощный и гибкий шаблонизатор, который значительно упрощает работу с представлениями в Symfony. Он отделяет логику отображения от бизнес-логики, поддерживает наследование шаблонов, макросы, условия и циклы. Twig также обладает интуитивным и простым синтаксисом, что делает его отличным выбором для создания удобных и безопасных шаблонов в веб-приложениях.
